{"version":3,"file":"ColumnSizing.js","sources":["../../../src/features/ColumnSizing.ts"],"sourcesContent":["import {\n  MouseEvent as ReactMouseEvent,\n  TouchEvent as ReactTouchEvent,\n} from 'react'\nimport {\n  Column,\n  Getter,\n  Header,\n  OnChangeFn,\n  PartialGenerics,\n  PropGetterValue,\n  TableInstance,\n  Updater,\n} from '../types'\nimport { functionalUpdate, makeStateUpdater, memo, propGetter } from '../utils'\n\n//\n\nexport type ColumnSizing = Record<string, number>\n\nexport type ColumnSizingInfoState = {\n  startOffset: null | number\n  startSize: null | number\n  deltaOffset: null | number\n  deltaPercentage: null | number\n  isResizingColumn: false | string\n  columnSizingStart: [string, number][]\n}\n\nexport type ColumnSizingTableState = {\n  columnSizing: ColumnSizing\n  columnSizingInfo: ColumnSizingInfoState\n}\n\nexport type ColumnResizeMode = 'onChange' | 'onEnd'\n\nexport type ColumnSizingOptions = {\n  enableColumnResizing?: boolean\n  columnResizeMode?: ColumnResizeMode\n  onColumnSizingChange?: OnChangeFn<ColumnSizing>\n  onColumnSizingInfoChange?: OnChangeFn<ColumnSizingInfoState>\n}\n\nexport type ColumnSizingDefaultOptions = {\n  columnResizeMode: ColumnResizeMode\n  onColumnSizingChange: OnChangeFn<ColumnSizing>\n  onColumnSizingInfoChange: OnChangeFn<ColumnSizingInfoState>\n}\n\nexport type ColumnResizerProps = {\n  title?: string\n  onMouseDown?: (e: ReactMouseEvent) => void\n  onTouchStart?: (e: ReactTouchEvent) => void\n  draggable?: boolean\n  role?: string\n}\n\nexport type ColumnSizingInstance<TGenerics extends PartialGenerics> = {\n  setColumnSizing: (updater: Updater<ColumnSizing>) => void\n  setColumnSizingInfo: (updater: Updater<ColumnSizingInfoState>) => void\n  resetColumnSizing: () => void\n  resetColumnSize: (columnId: string) => void\n  resetHeaderSize: (headerId: string) => void\n  resetHeaderSizeInfo: () => void\n  getColumnCanResize: (columnId: string) => boolean\n  getHeaderCanResize: (headerId: string) => boolean\n  getHeaderResizerProps: <TGetter extends Getter<ColumnResizerProps>>(\n    headerId: string,\n    userProps?: TGetter\n  ) => undefined | PropGetterValue<ColumnResizerProps, TGetter>\n  getColumnIsResizing: (columnId: string) => boolean\n  getHeaderIsResizing: (headerId: string) => boolean\n}\n\nexport type ColumnSizingColumnDef = {\n  enableResizing?: boolean\n  defaultCanResize?: boolean\n}\n\nexport type ColumnSizingColumn<TGenerics extends PartialGenerics> = {\n  getCanResize: () => boolean\n  getIsResizing: () => boolean\n  resetSize: () => void\n}\n\nexport type ColumnSizingHeader<TGenerics extends PartialGenerics> = {\n  getCanResize: () => boolean\n  getIsResizing: () => boolean\n  getResizerProps: <TGetter extends Getter<ColumnResizerProps>>(\n    userProps?: TGetter\n  ) => undefined | PropGetterValue<ColumnResizerProps, TGetter>\n  resetSize: () => void\n}\n\n//\n\nexport const defaultColumnSizing = {\n  width: 150,\n  minWidth: 20,\n  maxWidth: Number.MAX_SAFE_INTEGER,\n}\n\nexport const ColumnSizing = {\n  getInitialState: (): ColumnSizingTableState => {\n    return {\n      columnSizing: {},\n      columnSizingInfo: {\n        startOffset: null,\n        startSize: null,\n        deltaOffset: null,\n        deltaPercentage: null,\n        isResizingColumn: false,\n        columnSizingStart: [],\n      },\n    }\n  },\n\n  getDefaultOptions: <TGenerics extends PartialGenerics>(\n    instance: TableInstance<TGenerics>\n  ): ColumnSizingDefaultOptions => {\n    return {\n      columnResizeMode: 'onEnd',\n      onColumnSizingChange: makeStateUpdater('columnSizing', instance),\n      onColumnSizingInfoChange: makeStateUpdater('columnSizingInfo', instance),\n    }\n  },\n\n  getInstance: <TGenerics extends PartialGenerics>(\n    instance: TableInstance<TGenerics>\n  ): ColumnSizingInstance<TGenerics> => {\n    return {\n      setColumnSizing: updater =>\n        instance.options.onColumnSizingChange?.(\n          updater,\n          functionalUpdate(updater, instance.getState().columnSizing)\n        ),\n      setColumnSizingInfo: updater =>\n        instance.options.onColumnSizingInfoChange?.(\n          updater,\n          functionalUpdate(updater, instance.getState().columnSizingInfo)\n        ),\n      resetColumnSizing: () => {\n        instance.setColumnSizing(instance.initialState.columnSizing ?? {})\n      },\n      resetHeaderSizeInfo: () => {\n        instance.setColumnSizingInfo(\n          instance.initialState.columnSizingInfo ?? {}\n        )\n      },\n      resetColumnSize: columnId => {\n        instance.setColumnSizing(({ [columnId]: _, ...rest }) => {\n          return rest\n        })\n      },\n      resetHeaderSize: headerId => {\n        const header = instance.getHeader(headerId)\n\n        return instance.resetColumnSize(header.column.id)\n      },\n      getHeaderCanResize: headerId => {\n        const header = instance.getHeader(headerId)\n\n        if (!header) {\n          throw new Error()\n        }\n\n        return instance.getColumnCanResize(header.column.id)\n      },\n      getColumnCanResize: columnId => {\n        const column = instance.getColumn(columnId)\n\n        if (!column) {\n          throw new Error()\n        }\n\n        return (\n          column.enableResizing ??\n          instance.options.enableColumnResizing ??\n          column.defaultCanResize ??\n          true\n        )\n      },\n      getColumnIsResizing: columnId => {\n        const column = instance.getColumn(columnId)\n\n        if (!column) {\n          throw new Error()\n        }\n\n        return (\n          instance.getState().columnSizingInfo.isResizingColumn === columnId\n        )\n      },\n      getHeaderIsResizing: headerId => {\n        const header = instance.getHeader(headerId)\n\n        if (!header) {\n          throw new Error()\n        }\n\n        return instance.getColumnIsResizing(header.column.id)\n      },\n\n      getHeaderResizerProps: (headerId, userProps) => {\n        const header = instance.getHeader(headerId)\n        const column = instance.getColumn(header.column.id)\n\n        const canResize = column.getCanResize()\n\n        const onResizeStart = (e: ReactMouseEvent | ReactTouchEvent) => {\n          if (isTouchStartEvent(e)) {\n            // lets not respond to multiple touches (e.g. 2 or 3 fingers)\n            if (e.touches && e.touches.length > 1) {\n              return\n            }\n          }\n\n          const header = headerId ? instance.getHeader(headerId) : undefined\n\n          const startSize = header ? header.getWidth() : column.getWidth()\n\n          const columnSizingStart: [string, number][] = header\n            ? header.getLeafHeaders().map(d => [d.column.id, d.getWidth()])\n            : [[column.id, column.getWidth()]]\n\n          const clientX = isTouchStartEvent(e)\n            ? Math.round(e.touches[0].clientX)\n            : e.clientX\n\n          const updateOffset = (\n            eventType: 'move' | 'end',\n            clientXPos?: number\n          ) => {\n            if (typeof clientXPos !== 'number') {\n              return\n            }\n\n            let newColumnSizing: ColumnSizing = {}\n\n            instance.setColumnSizingInfo(old => {\n              const deltaOffset = clientXPos - (old?.startOffset ?? 0)\n              const deltaPercentage = Math.max(\n                deltaOffset / (old?.startSize ?? 0),\n                -0.999999\n              )\n\n              old.columnSizingStart.forEach(([columnId, headerWidth]) => {\n                newColumnSizing[columnId] =\n                  Math.round(\n                    Math.max(headerWidth + headerWidth * deltaPercentage, 0) *\n                      100\n                  ) / 100\n              })\n\n              return {\n                ...old,\n                deltaOffset,\n                deltaPercentage,\n              }\n            })\n\n            if (\n              instance.options.columnResizeMode === 'onChange' ||\n              eventType === 'end'\n            ) {\n              instance.setColumnSizing(old => ({\n                ...old,\n                ...newColumnSizing,\n              }))\n            }\n          }\n\n          const onMove = (clientXPos?: number) =>\n            updateOffset('move', clientXPos)\n\n          const onEnd = (clientXPos?: number) => {\n            updateOffset('end', clientXPos)\n\n            instance.setColumnSizingInfo(old => ({\n              ...old,\n              isResizingColumn: false,\n              startOffset: null,\n              startSize: null,\n              deltaOffset: null,\n              deltaPercentage: null,\n              columnSizingStart: [],\n            }))\n          }\n\n          const mouseEvents = {\n            moveHandler: (e: MouseEvent) => onMove(e.clientX),\n            upHandler: (e: MouseEvent) => {\n              document.removeEventListener('mousemove', mouseEvents.moveHandler)\n              document.removeEventListener('mouseup', mouseEvents.upHandler)\n              onEnd(e.clientX)\n            },\n          }\n\n          const touchEvents = {\n            moveHandler: (e: TouchEvent) => {\n              if (e.cancelable) {\n                e.preventDefault()\n                e.stopPropagation()\n              }\n              onMove(e.touches[0].clientX)\n              return false\n            },\n            upHandler: (e: TouchEvent) => {\n              document.removeEventListener('touchmove', touchEvents.moveHandler)\n              document.removeEventListener('touchend', touchEvents.upHandler)\n              if (e.cancelable) {\n                e.preventDefault()\n                e.stopPropagation()\n              }\n              onEnd(e.touches[0].clientX)\n            },\n          }\n\n          const passiveIfSupported = passiveEventSupported()\n            ? { passive: false }\n            : false\n\n          if (isTouchStartEvent(e)) {\n            document.addEventListener(\n              'touchmove',\n              touchEvents.moveHandler,\n              passiveIfSupported\n            )\n            document.addEventListener(\n              'touchend',\n              touchEvents.upHandler,\n              passiveIfSupported\n            )\n          } else {\n            document.addEventListener(\n              'mousemove',\n              mouseEvents.moveHandler,\n              passiveIfSupported\n            )\n            document.addEventListener(\n              'mouseup',\n              mouseEvents.upHandler,\n              passiveIfSupported\n            )\n          }\n\n          instance.setColumnSizingInfo(old => ({\n            ...old,\n            startOffset: clientX,\n            startSize,\n            deltaOffset: 0,\n            deltaPercentage: 0,\n            columnSizingStart,\n            isResizingColumn: column.id,\n          }))\n        }\n\n        const initialProps: ColumnResizerProps = canResize\n          ? {\n              title: 'Toggle Grouping',\n              draggable: false,\n              role: 'separator',\n              onMouseDown: (e: ReactMouseEvent) => {\n                e.persist()\n                onResizeStart(e)\n              },\n              onTouchStart: (e: ReactTouchEvent) => {\n                e.persist()\n                onResizeStart(e)\n              },\n            }\n          : {}\n\n        return propGetter(initialProps, userProps)\n      },\n    }\n  },\n\n  createColumn: <TGenerics extends PartialGenerics>(\n    column: Column<TGenerics>,\n    instance: TableInstance<TGenerics>\n  ): ColumnSizingColumn<TGenerics> => {\n    return {\n      getIsResizing: () => instance.getColumnIsResizing(column.id),\n      getCanResize: () => instance.getColumnCanResize(column.id),\n      resetSize: () => instance.resetColumnSize(column.id),\n    }\n  },\n\n  createHeader: <TGenerics extends PartialGenerics>(\n    header: Header<TGenerics>,\n    instance: TableInstance<TGenerics>\n  ): ColumnSizingHeader<TGenerics> => {\n    return {\n      getIsResizing: () => instance.getColumnIsResizing(header.column.id),\n      getCanResize: () => instance.getColumnCanResize(header.column.id),\n      resetSize: () => instance.resetColumnSize(header.column.id),\n      getResizerProps: userProps =>\n        instance.getHeaderResizerProps(header.id, userProps),\n    }\n  },\n}\n\nlet passiveSupported: boolean | null = null\nexport function passiveEventSupported() {\n  if (typeof passiveSupported === 'boolean') return passiveSupported\n\n  let supported = false\n  try {\n    const options = {\n      get passive() {\n        supported = true\n        return false\n      },\n    }\n\n    const noop = () => {}\n\n    window.addEventListener('test', noop, options)\n    window.removeEventListener('test', noop)\n  } catch (err) {\n    supported = false\n  }\n  passiveSupported = supported\n  return passiveSupported\n}\n\nfunction isTouchStartEvent(\n  e: ReactTouchEvent | ReactMouseEvent\n): e is ReactTouchEvent {\n  return e.type === 'touchstart'\n}\n"],"names":["defaultColumnSizing","width","minWidth","maxWidth","Number","MAX_SAFE_INTEGER","ColumnSizing","getInitialState","columnSizing","columnSizingInfo","startOffset","startSize","deltaOffset","deltaPercentage","isResizingColumn","columnSizingStart","getDefaultOptions","instance","columnResizeMode","onColumnSizingChange","makeStateUpdater","onColumnSizingInfoChange","getInstance","setColumnSizing","updater","options","functionalUpdate","getState","setColumnSizingInfo","resetColumnSizing","initialState","resetHeaderSizeInfo","resetColumnSize","columnId","rest","resetHeaderSize","headerId","header","getHeader","column","id","getHeaderCanResize","Error","getColumnCanResize","getColumn","enableResizing","enableColumnResizing","defaultCanResize","getColumnIsResizing","getHeaderIsResizing","getHeaderResizerProps","userProps","canResize","getCanResize","onResizeStart","e","isTouchStartEvent","touches","length","undefined","getWidth","getLeafHeaders","map","d","clientX","Math","round","updateOffset","eventType","clientXPos","newColumnSizing","old","max","forEach","headerWidth","onMove","onEnd","mouseEvents","moveHandler","upHandler","document","removeEventListener","touchEvents","cancelable","preventDefault","stopPropagation","passiveIfSupported","passiveEventSupported","passive","addEventListener","initialProps","title","draggable","role","onMouseDown","persist","onTouchStart","propGetter","createColumn","getIsResizing","resetSize","createHeader","getResizerProps","passiveSupported","supported","noop","window","err","type"],"mappings":"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"}